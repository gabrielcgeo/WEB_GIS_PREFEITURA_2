{% extends "base.html" %}
{% block head %}
<style>
    #map { height: calc(100vh - 56px); width: 100vw; margin: 0; padding: 0; left: 0; position: fixed;}
    .content-body { height: calc(100vh - 56px); }
    .container-fluid.mt-2 { display: none; } /* Oculta a √°rea de flash messages no mapa */
    .info-panel { position: absolute; top: 10px; right: 10px; z-index: 1000; background: white; padding: 10px; border-radius: 5px; box-shadow: 0 0 15px rgba(0,0,0,0.2); max-height: calc(100vh - 80px); overflow-y: auto; max-width: 300px; }
    .leaflet-custom-toolbar { position: absolute; top: 10px; left: 50px; z-index: 1000; background: white; border-radius: 4px; box-shadow: 0 0 15px rgba(0,0,0,0.2); }
    .leaflet-custom-toolbar a { display: block; width: 30px; height: 30px; text-align: center; line-height: 30px; font-size: 1.2em; color: black; border-bottom: 1px solid #ccc; }
    .modal-dialog { max-width: 80%; }
</style>
{% endblock %}
{% block content %}
<div id="map"></div>
<div class="leaflet-custom-toolbar"> 
    <a href="#" id="measure-tool" title="Medir Dist√¢ncia">üìè</a>
    <a href="#" id="clear-measure" title="Limpar Medi√ß√£o">üóëÔ∏è</a>
</div>
<div class="info-panel">
    </div>
<div class="modal fade" id="info-modal" tabindex="-1"><div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="info-modal-title"></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body" id="info-modal-body"></div></div></div></div>
{% endblock %}
{% block scripts %}
<script>
    // Script completo do mapa (ser√° adicionado aqui)
    // Placeholder para evitar erro de sintaxe
    document.addEventListener('DOMContentLoaded', function() {
        const companySlug = {{ company.slug|tojson }};
        if (!companySlug) return;
        
        const map = L.map('map');
        const infoModal = new bootstrap.Modal(document.getElementById('info-modal'));
        
        // L√≥gica para parsear URL e setar a vis√£o inicial
        const hash = window.location.hash.substring(1);
        const params = new URLSearchParams(hash);
        const lat = params.get('lat') || -19.91;
        const lng = params.get('lng') || -43.93;
        const zoom = params.get('zoom') || 12;

        map.setView([lat, lng], zoom);
        
        // Adicionar l√≥gica de basemaps, fetch de camadas, etc. aqui
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        
        console.log(`Mapa iniciado para a empresa: ${companySlug}`);
        fetch(`/portal/${companySlug}/api/camadas`).then(r => r.json()).then(camadas => console.log('Camadas:', camadas));
    });
</script>
{% endblock %}